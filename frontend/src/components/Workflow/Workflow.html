<section class="workflow" data-component="workflow">
  <header class="workflow__header">
    <div class="workflow__titles">
      <h1>Control de documentos comerciales</h1>
      <p>Cuatro pasos para aprobar expedientes de importación y exportación.</p>
    </div>
    <div class="workflow__session">
      <span class="workflow__status-badge" data-doc-state-badge>Sin documento cargado</span>
      <button type="button" class="ghost-button" data-action="logout">Cerrar sesión</button>
    </div>
  </header>

  <div class="workflow__layout">
    <aside class="workflow__steps">
      <button type="button" class="workflow-step is-active" data-step-target="upload">
        <span>1</span>
        Subir documento
      </button>
      <button type="button" class="workflow-step" data-step-target="verify">
        <span>2</span>
        Verificar documento
      </button>
      <button type="button" class="workflow-step" data-step-target="chat">
        <span>3</span>
        Asistente IA
      </button>
      <button type="button" class="workflow-step" data-step-target="edit">
        <span>4</span>
        Editar documento
      </button>
      <button type="button" class="workflow-step" data-step-target="summary">
        <span>5</span>
        Resumen del documento
      </button>
    </aside>

    <div class="workflow__panels">
      <article class="workflow-panel is-active" data-panel="upload">
        <header>
          <h2>Subir documento</h2>
          <p>Adjunta un PDF o captura una foto para iniciar la revisión.</p>
        </header>
        <form data-form="upload" class="upload-form">
          <label class="upload-dropzone">
            <input type="file" name="file" accept=".pdf,.png,.jpg,.jpeg" required />
            <strong>Arrastra o selecciona un archivo</strong>
            <span>PDF, JPG o PNG. Tamaño máximo 15 MB.</span>
          </label>
          <div class="upload-alternatives">
            <span>o</span>
            <button type="button" class="secondary-button" data-action="open-camera">Usar cámara</button>
          </div>
          <div class="upload-form__grid">
            <label>
              <span>Tipo de documento</span>
              <select name="doc_type">
                <option value="">Seleccionar</option>
                <option value="factura_comercial">Factura comercial</option>
                <option value="packing_list">Packing list</option>
                <option value="bl">Bill of Lading</option>
                <option value="certificado_fitosanitario">Certificado Fitosanitario</option>
                <option value="certificado_origen">Certificado de Origen</option>
                <option value="dus">Declaración Aduanera (DUS)</option>
                <option value="guia_despacho">Guía de Despacho</option>
              </select>
            </label>
            <label>
              <span>Idioma</span>
              <select name="language_hint">
                <option value="">Auto</option>
                <option value="es">Español</option>
                <option value="en">Inglés</option>
                <option value="pt">Portugués</option>
              </select>
            </label>
          </div>
          <button type="submit" class="primary-button">Enviar al analizador</button>
        </form>
        <div class="camera-capture" data-camera-panel>
          <video autoplay playsinline muted data-camera-video></video>
          <div class="camera-capture__actions">
            <button type="button" class="primary-button" data-action="capture-photo">Usar esta foto</button>
            <button type="button" class="ghost-button" data-action="close-camera">Cancelar</button>
          </div>
          <p>Enfoca el documento completo antes de tomar la fotografía.</p>
          <canvas data-camera-canvas hidden></canvas>
        </div>
        
        <!-- Processing Log Overlay -->
        <div class="processing-log" data-processing-log hidden>
          <div class="processing-log__terminal">
            <div class="processing-log__header">
              <span class="dot red"></span>
              <span class="dot yellow"></span>
              <span class="dot green"></span>
              <span class="title">App_Inova AI Engine</span>
            </div>
            <div class="processing-log__content" data-log-content>
              <!-- Log lines will be injected here -->
            </div>
          </div>
        </div>

        <p class="upload-status" data-upload-status data-status="idle">Listo para cargar un archivo.</p>
      </article>

      <article class="workflow-panel" data-panel="verify">
        <header>
          <h2>Verificar documento</h2>
          <p>Consulta metadatos, entidades detectadas y texto OCR para validar el contenido.</p>
        </header>
        <div class="panel-grid">
          <section class="panel-card">
            <header>
              <h3>Estado del procesamiento</h3>
              <button type="button" class="ghost-button" data-action="refresh-doc">Actualizar datos</button>
            </header>
            <ul class="meta-list" data-doc-meta></ul>
          </section>
          <section class="panel-card">
            <header>
              <h3>Hallazgos críticos</h3>
            </header>
            <ul class="signals-list" data-doc-signals></ul>
          </section>
        </div>
        <div class="panel-grid">
          <section class="panel-card">
            <header>
              <h3>Ortografía y términos críticos</h3>
            </header>
            <ul class="signals-list" data-spell-list></ul>
          </section>
          <section class="panel-card">
            <header>
              <h3>Sugerencias automáticas</h3>
            </header>
            <ul class="signals-list" data-suggestion-list></ul>
          </section>
        </div>
        <section class="panel-card panel-card--wide">
          <header>
            <h3>Texto OCR y palabras clave</h3>
          </header>
          <pre class="text-preview" data-text-preview>Sube un documento para ver el texto reconocido.</pre>
          <div class="tag-cloud" data-keyword-chips></div>
          <ul class="entity-table" data-entity-list></ul>
        </section>
      </article>

      <article class="workflow-panel" data-panel="chat">
        <header>
          <h2>Asistente IA</h2>
          <p>Interactúa con el documento para extraer información específica o aclarar dudas.</p>
        </header>
        <div class="chat-interface">
          <div class="chat-messages" data-chat-messages>
            <div class="chat-message system">
              <div class="avatar">AI</div>
              <div class="content">Hola, soy tu asistente documental. Pregúntame sobre el peso, el exportador, o si hay errores en el documento.</div>
            </div>
          </div>
          <form class="chat-input" data-chat-form>
            <input type="text" name="query" placeholder="Escribe tu pregunta aquí..." autocomplete="off" />
            <button type="submit" class="primary-button">Enviar</button>
          </form>
        </div>
      </article>

      <article class="workflow-panel" data-panel="edit">
        <header>
          <h2>Editar documento</h2>
          <p>Selecciona ajustes automáticos para corregir formatos y cumplir con el checklist.</p>
        </header>
        <div class="panel-card panel-card--wide">
          <header>
            <h3>Opciones de ajuste</h3>
          </header>
          <form class="auto-options" data-auto-options>
            <label>
              <input type="checkbox" name="normalize_amounts" value="true" checked />
              Normalizar montos a formato 12 345,67 ➜ 12345.67
            </label>
            <label>
              <input type="checkbox" name="ensure_incoterm" value="true" checked />
              Confirmar que el INCOTERM aparezca en cabecera y pie de página
            </label>
            <label>
              <input type="checkbox" name="flag_missing_fields" value="true" />
              Señalar campos obligatorios vacíos (número de contenedor, BL, HS Code)
            </label>
            <label>
              <input type="checkbox" name="language_consistency" value="true" />
              Unificar idioma a español para mensajes del cliente
            </label>
          </form>
          <div class="auto-actions">
            <button type="button" class="primary-button" data-action="apply-fixes">Aplicar ajustes automáticos</button>
            <span class="auto-status" data-auto-status>Sin ajustes generados todavía.</span>
          </div>
          <div class="auto-result" data-auto-result></div>
        </div>
      </article>

      <article class="workflow-panel" data-panel="summary">
        <header>
          <h2>Resumen del documento</h2>
          <p>Consolida hallazgos, riesgos y acciones automáticas antes de compartir.</p>
        </header>
        <div class="panel-card panel-card--wide" data-summary-card>
          <p>Necesitas procesar un documento para generar el resumen.</p>
        </div>
        <div class="summary-actions">
          <button type="button" class="ghost-button" data-action="download-report">Descargar informe (.json)</button>
        </div>
      </article>
    </div>
  </div>
</section>
